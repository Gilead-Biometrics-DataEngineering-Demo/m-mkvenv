#!/bin/bash
######### start of header ######################################
# Program Name:  m-mkvenv (BASH script)
# Author:        Larry Sleeper (lsleeper)
# Description:   Standardize how Python3 virtual environments are created at Gilead
#             	 Use git to get requirements from Gilead github repo
#
# Category:      Utility
# Macros called: 
# Parameter:                
# Usage:         m-mkvenv -v my_new_python_venv
#                                                                       
# Change History: 
#      2021-02-11  lsleeper - Original programming   
# register execution back into git?  Pei, 3/3/2021
########## end of header ###########################################/

if [ $# -eq 0 ]; then
    echo "No arguments provided"
    exit 1
fi

while getopts :v:r:p: c; do
	case $c in
		v) _venvname=$OPTARG ;;
		r) _reqtxt=$OPTARG ;;		
		h) usage
		   exit 1 ;;
	esac
done

echo $_venvname

if [ "$_venvname" == "" ]; then
	echo "Need virtual environment name specified with -v argument.  No env created"
	exit 1
fi

if [ -d "$_venvname" ]; then
	echo "Virtual environment $_venvname directory already exists"
	exit 1 
fi

echo "Creating and activating Python 3.6 Virtual Environment $_venvname"

python3.6 -m venv "$_venvname"

source "$_venvname/bin/activate"

<<<<<<< HEAD
pip3 install --upgrade pip==21.0.1
=======
pip install --upgrade pip==21.1
>>>>>>> 2256f5b54eb036c8995214267284cdc9385da639

if ["$_reqtxt" == ""]; then

	echo "Installing from Gilead standard requirements.txt file"
	git clone git@github.com:Gilead-Biometrics-DataEngineering/gpythonvenv.git
	pip install -r gpythonvenv/gpythonvenv_requirements.txt 
	
else 

	echo "Installing from user specified requirements.txt file $_reqtxt"
	pip install -r "$_reqtxt"
	
fi

deactivate

